window.CMB2=function(window,document,$,undefined){"use strict";var l10n=window.cmb2_l10;var setTimeout=window.setTimeout;var cmb={formfield:"",idNumber:false,file_frames:{},repeatEls:'input:not([type="button"]),select,textarea,.cmb2-media-status',styleBreakPoint:450,mediaHandlers:{},neweditor_id:[],defaults:{time_picker:l10n.defaults.time_picker,date_picker:l10n.defaults.date_picker,color_picker:l10n.defaults.color_picker||{}}};var $id=function(selector){return $(document.getElementById(selector))};cmb.metabox=function(){if(cmb.$metabox){return cmb.$metabox}cmb.$metabox=$(".cmb2-wrap > .cmb2-metabox");return cmb.$metabox};cmb.init=function(){cmb.log("CMB2 localized data",l10n);var $metabox=cmb.metabox();var $repeatGroup=$metabox.find(".cmb-repeatable-group");cmb.initPickers($metabox.find('input[type="text"].cmb2-timepicker'),$metabox.find('input[type="text"].cmb2-datepicker'),$metabox.find('input[type="text"].cmb2-colorpicker'));$id("ui-datepicker-div").wrap('<div class="cmb2-element" />');$('<p><span class="button cmb-multicheck-toggle">'+l10n.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)");cmb.makeListSortable();$metabox.on("change",".cmb2_upload_file",function(){cmb.formfield=$(this).attr("id");$id(cmb.formfield+"_id").val("")}).on("click",".cmb-multicheck-toggle",cmb.toggleCheckBoxes).on("click",".cmb2-upload-button",cmb.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",cmb.handleFileClick).on("click",".cmb2-remove-file-button",cmb.handleRemoveMedia).on("click",".cmb-add-group-row",cmb.addGroupRow).on("click",".cmb-add-row-button",cmb.addAjaxRow).on("click",".cmb-remove-group-row",cmb.removeGroupRow).on("click",".cmb-remove-row-button",cmb.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",cmb.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",cmb.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",cmb.toggleHandle);if($repeatGroup.length){$repeatGroup.filter(".sortable").each(function(){$(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+l10n.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+l10n.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",cmb.shiftRows).on("cmb2_add_row",cmb.emptyValue)}setTimeout(cmb.resizeoEmbeds,500);$(window).on("resize",cmb.resizeoEmbeds)};cmb.resetTitlesAndIterator=function(){$(".cmb-repeatable-group").each(function(){var $table=$(this);$table.find(".cmb-repeatable-grouping").each(function(rowindex){var $row=$(this);$row.data("iterator",rowindex);$row.find(".cmb-group-title h4").text($table.find(".cmb-add-group-row").data("grouptitle").replace("{#}",rowindex+1))})})};cmb.toggleHandle=function(evt){evt.preventDefault();$(document).trigger("postbox-toggled",$(this).parent(".postbox").toggleClass("closed"))};cmb.toggleCheckBoxes=function(evt){evt.preventDefault();var $self=$(this);var $multicheck=$self.closest(".cmb-td").find("input[type=checkbox]");if($self.data("checked")){$multicheck.prop("checked",false);$self.data("checked",false)}else{$multicheck.prop("checked",true);$self.data("checked",true)}};cmb.handleMedia=function(evt){evt.preventDefault();var $el=$(this);cmb.attach_id=!$el.hasClass("cmb2-upload-list")?$el.closest(".cmb-td").find(".cmb2-upload-file-id").val():false;cmb.attach_id="0"!==cmb.attach_id?cmb.attach_id:false;cmb._handleMedia($el.prev("input.cmb2-upload-file").attr("id"),$el.hasClass("cmb2-upload-list"))};cmb.handleFileClick=function(evt){evt.preventDefault();var $el=$(this);var $td=$el.closest(".cmb-td");var isList=$td.find(".cmb2-upload-button").hasClass("cmb2-upload-list");cmb.attach_id=isList?$el.find('input[type="hidden"]').data("id"):$td.find(".cmb2-upload-file-id").val();if(cmb.attach_id){cmb._handleMedia($td.find("input.cmb2-upload-file").attr("id"),isList,cmb.attach_id)}};cmb._handleMedia=function(formfield,isList){if(!wp){return}var $metabox=cmb.metabox();cmb.formfield=formfield;var $formfield=$id(cmb.formfield);var previewSize=$formfield.data("previewsize");var formName=$formfield.attr("name");var uploadStatus=true;var attachment=true;if(cmb.formfield in cmb.file_frames){cmb.file_frames[cmb.formfield].open();return}cmb.file_frames[cmb.formfield]=wp.media({title:$metabox.find("label[for="+cmb.formfield+"]").text(),button:{text:l10n.strings.upload_file},multiple:isList?true:false});cmb.mediaHandlers.list=function(selection,returnIt){attachment=selection.toJSON();$formfield.val(attachment.url);$id(cmb.formfield+"_id").val(attachment.id);var fileGroup=[];$(attachment).each(function(){if(this.type&&this.type==="image"){var width=previewSize[0]?previewSize[0]:50;var height=previewSize[1]?previewSize[1]:50;uploadStatus='<li class="img-status">'+'<img width="'+width+'" height="'+height+'" src="'+this.url+'" class="attachment-'+width+"px"+height+'px" alt="'+this.filename+'">'+'<p><a href="#" class="cmb2-remove-file-button" rel="'+cmb.formfield+"["+this.id+']">'+l10n.strings.remove_image+"</a></p>"+'<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+formName+"["+this.id+']" value="'+this.url+'">'+"</li>"}else{uploadStatus='<li class="file-status"><span>'+l10n.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+l10n.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+cmb.formfield+"["+this.id+']">'+l10n.strings.remove_file+"</a>)"+'<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+formName+"["+this.id+']" value="'+this.url+'">'+"</li>"}fileGroup.push(uploadStatus)});if(!returnIt){$(fileGroup).each(function(){$formfield.siblings(".cmb2-media-status").slideDown().append(this)})}else{return fileGroup}};cmb.mediaHandlers.single=function(selection){attachment=selection.first().toJSON();$formfield.val(attachment.url);$id(cmb.formfield+"_id").val(attachment.id);if(attachment.type&&attachment.type==="image"){var width=previewSize[0]?previewSize[0]:350;uploadStatus='<div class="img-status"><img width="'+width+'px" style="max-width: '+width+'px; width: 100%; height: auto;" src="'+attachment.url+'" alt="'+attachment.filename+'" title="'+attachment.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+cmb.formfield+'">'+l10n.strings.remove_image+"</a></p></div>"}else{uploadStatus='<div class="file-status"><span>'+l10n.strings.file+" <strong>"+attachment.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+attachment.url+'" target="_blank" rel="external">'+l10n.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+cmb.formfield+'">'+l10n.strings.remove_file+"</a>)</div>"}$formfield.siblings(".cmb2-media-status").slideDown().html(uploadStatus)};cmb.mediaHandlers.selectFile=function(){var selection=cmb.file_frames[cmb.formfield].state().get("selection");var type=isList?"list":"single";if(cmb.attach_id&&isList){$('[data-id="'+cmb.attach_id+'"]').parents("li").replaceWith(cmb.mediaHandlers.list(selection,true));return}cmb.mediaHandlers[type](selection)};cmb.mediaHandlers.openModal=function(){var selection=cmb.file_frames[cmb.formfield].state().get("selection");if(!cmb.attach_id){return selection.reset()}var attach=wp.media.attachment(cmb.attach_id);attach.fetch();selection.set(attach?[attach]:[])};cmb.file_frames[cmb.formfield].on("select",cmb.mediaHandlers.selectFile).on("open",cmb.mediaHandlers.openModal);cmb.file_frames[cmb.formfield].open()};cmb.handleRemoveMedia=function(evt){evt.preventDefault();var $self=$(this);if($self.is(".cmb-attach-list .cmb2-remove-file-button")){$self.parents("li").remove();return false}cmb.formfield=$self.attr("rel");cmb.metabox().find("input#"+cmb.formfield).val("");cmb.metabox().find("input#"+cmb.formfield+"_id").val("");$self.parents(".cmb2-media-status").html("");return false};cmb.cleanRow=function($row,prevNum,group){var $inputs=$row.find('input:not([type="button"]), select, textarea, label');var $other=$row.find("[id]").not('input:not([type="button"]), select, textarea, label');if(group){$row.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove();if($other.length){$other.each(function(){var $_this=$(this);var oldID=$_this.attr("id");var newID=oldID.replace("_"+prevNum,"_"+cmb.idNumber);var $buttons=$row.find('[data-selector="'+oldID+'"]');$_this.attr("id",newID);if($buttons.length){$buttons.attr("data-selector",newID).data("selector",newID)}})}}cmb.neweditor_id=[];$inputs.filter(":checked").prop("checked",false);$inputs.filter(":selected").prop("selected",false);if($row.find("h3.cmb-group-title").length){$row.find("h3.cmb-group-title").text($row.data("title").replace("{#}",cmb.idNumber+1))}$inputs.each(function(){var $newInput=$(this);var isEditor=$newInput.hasClass("wp-editor-area");var oldFor=$newInput.attr("for");var oldVal=$newInput.attr("value");var attrs={};var newID,oldID;if(oldFor){attrs={"for":oldFor.replace("_"+prevNum,"_"+cmb.idNumber)}}else{var oldName=$newInput.attr("name");var newName=oldName?oldName.replace("["+prevNum+"]","["+cmb.idNumber+"]"):"";oldID=$newInput.attr("id");newID=oldID?oldID.replace("_"+prevNum,"_"+cmb.idNumber):"";attrs={id:newID,name:newName,"data-iterator":cmb.idNumber}}if(undefined!==typeof oldVal&&oldVal){attrs.value=""}if("TEXTAREA"===$newInput.prop("tagName")){$newInput.html("")}$newInput.removeClass("hasDatepicker").attr(attrs).val("");if(isEditor){newID=newID?oldID.replace("zx"+prevNum,"zx"+cmb.idNumber):"";$newInput.html("");var $wysiwyg=$newInput.parents(".cmb-type-wysiwyg");$wysiwyg.find(".mce-tinymce:not(:first-child)").remove();var html=$wysiwyg.html().replace(new RegExp(oldID,"g"),newID);$wysiwyg.html(html);cmb.neweditor_id.push({id:newID,old:oldID})}});return cmb};cmb.newRowHousekeeping=function($row){var $colorPicker=$row.find(".wp-picker-container");var $list=$row.find(".cmb2-media-status");if($colorPicker.length){$colorPicker.each(function(){var $td=$(this).parent();$td.html($td.find('input[type="text"].cmb2-colorpicker').attr("style",""))})}if($list.length){$list.empty()}return cmb};cmb.afterRowInsert=function($row){var _prop;if(cmb.neweditor_id.length){var i;for(i=cmb.neweditor_id.length-1;i>=0;i--){var id=cmb.neweditor_id[i].id;var old=cmb.neweditor_id[i].old;if(typeof tinyMCEPreInit.mceInit[id]==="undefined"){var newSettings=jQuery.extend({},tinyMCEPreInit.mceInit[old]);for(_prop in newSettings){if("string"===typeof newSettings[_prop]){newSettings[_prop]=newSettings[_prop].replace(new RegExp(old,"g"),id)}}tinyMCEPreInit.mceInit[id]=newSettings}if(typeof tinyMCEPreInit.qtInit[id]==="undefined"){var newQTS=jQuery.extend({},tinyMCEPreInit.qtInit[old]);for(_prop in newQTS){if("string"===typeof newQTS[_prop]){newQTS[_prop]=newQTS[_prop].replace(new RegExp(old,"g"),id)}}tinyMCEPreInit.qtInit[id]=newQTS}tinyMCE.init({id:tinyMCEPreInit.mceInit[id]})}}cmb.initPickers($row.find('input[type="text"].cmb2-timepicker'),$row.find('input[type="text"].cmb2-datepicker'),$row.find('input[type="text"].cmb2-colorpicker'))};cmb.updateNameAttr=function(){var $this=$(this);var name=$this.attr("name");if(typeof name==="undefined"){return false}var prevNum=parseInt($this.parents(".cmb-repeatable-grouping").data("iterator"));var newNum=prevNum-1;var $newName=name.replace("["+prevNum+"]","["+newNum+"]");$this.attr("name",$newName)};cmb.emptyValue=function(evt,row){$('input:not([type="button"]), textarea',row).val("")};cmb.addGroupRow=function(evt){evt.preventDefault();var $self=$(this);$self.trigger("cmb2_add_group_row_start",$self);var $table=$id($self.data("selector"));var $oldRow=$table.find(".cmb-repeatable-grouping").last();var prevNum=parseInt($oldRow.data("iterator"));cmb.idNumber=prevNum+1;var $row=$oldRow.clone();cmb.newRowHousekeeping($row.data("title",$self.data("grouptitle"))).cleanRow($row,prevNum,true);$row.find(".cmb-add-row-button").prop("disabled",false);var $newRow=$('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+cmb.idNumber+'">'+$row.html()+"</div>");$oldRow.after($newRow);cmb.afterRowInsert($newRow);if($table.find(".cmb-repeatable-grouping").length<=1){$table.find(".cmb-remove-group-row").prop("disabled",true)}else{$table.find(".cmb-remove-group-row").prop("disabled",false)}$table.trigger("cmb2_add_row",$newRow)};cmb.addAjaxRow=function(evt){evt.preventDefault();var $self=$(this);var $table=$id($self.data("selector"));var $emptyrow=$table.find(".empty-row");var prevNum=parseInt($emptyrow.find("[data-iterator]").data("iterator"));cmb.idNumber=prevNum+1;var $row=$emptyrow.clone();cmb.newRowHousekeeping($row).cleanRow($row,prevNum);$emptyrow.removeClass("empty-row hidden").addClass("cmb-repeat-row");$emptyrow.after($row);cmb.afterRowInsert($row);$table.trigger("cmb2_add_row",$row);$table.find(".cmb-remove-row-button").removeClass("button-disabled")};cmb.removeGroupRow=function(evt){evt.preventDefault();var $self=$(this);var $table=$id($self.data("selector"));var $parent=$self.parents(".cmb-repeatable-grouping");var number=$table.find(".cmb-repeatable-grouping").length;if(number>1){$table.trigger("cmb2_remove_group_row_start",$self);$parent.nextAll(".cmb-repeatable-grouping").find(cmb.repeatEls).each(cmb.updateNameAttr);$parent.remove();if(number<=2){$table.find(".cmb-remove-group-row").prop("disabled",true)}else{$table.find(".cmb-remove-group-row").prop("disabled",false)}$table.trigger("cmb2_remove_row")}};cmb.removeAjaxRow=function(evt){evt.preventDefault();var $self=$(this);if($self.hasClass("button-disabled")){return}var $parent=$self.parents(".cmb-row");var $table=$self.parents(".cmb-repeat-table");var number=$table.find(".cmb-row").length;if(number>2){if($parent.hasClass("empty-row")){$parent.prev().addClass("empty-row").removeClass("cmb-repeat-row")}$self.parents(".cmb-repeat-table .cmb-row").remove();if(number===3){$table.find(".cmb-remove-row-button").addClass("button-disabled")}$table.trigger("cmb2_remove_row")}else{$self.addClass("button-disabled")}};cmb.shiftRows=function(evt){evt.preventDefault();var $self=$(this);$self.trigger("cmb2_shift_rows_enter",$self);var $parent=$self.parents(".cmb-repeatable-grouping");var $goto=$self.hasClass("move-up")?$parent.prev(".cmb-repeatable-grouping"):$parent.next(".cmb-repeatable-grouping");if(!$goto.length){return}$self.trigger("cmb2_shift_rows_start",$self);var inputVals=[];$parent.find(cmb.repeatEls).each(function(){var $element=$(this);var val;if($element.hasClass("cmb2-media-status")){val=$element.html()}else if("checkbox"===$element.attr("type")||"radio"===$element.attr("type")){val=$element.is(":checked")}else if("select"===$element.prop("tagName")){val=$element.is(":selected")}else{val=$element.val()}inputVals.push({val:val,$:$element})});$goto.find(cmb.repeatEls).each(function(index){var $element=$(this);var val;if($element.hasClass("cmb2-media-status")){val=$element.html();$element.html(inputVals[index].val);inputVals[index].$.html(val)}else if("checkbox"===$element.attr("type")||"radio"===$element.attr("type")){inputVals[index].$.prop("checked",$element.is(":checked"));$element.prop("checked",inputVals[index].val)}else if("select"===$element.prop("tagName")){inputVals[index].$.prop("selected",$element.is(":selected"));$element.prop("selected",inputVals[index].val)}else{inputVals[index].$.val($element.val());$element.val(inputVals[index].val)}});$self.trigger("cmb2_shift_rows_complete",$self)};cmb.initPickers=function($timePickers,$datePickers,$colorPickers){cmb.initTimePickers($timePickers);cmb.initDatePickers($datePickers);cmb.initColorPickers($colorPickers)};cmb.initTimePickers=function($selector){if(!$selector.length){return}$selector.timepicker("destroy");$selector.timepicker(cmb.defaults.time_picker)};cmb.initDatePickers=function($selector){if(!$selector.length){return}$selector.datepicker("destroy");$selector.datepicker(cmb.defaults.date_picker)};cmb.initColorPickers=function($selector){if(!$selector.length){return}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){$selector.wpColorPicker(cmb.defaults.color_picker)}else{$selector.each(function(i){$(this).after('<div id="picker-'+i+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');$id("picker-"+i).hide().farbtastic($(this))}).focus(function(){$(this).next().show()}).blur(function(){$(this).next().hide()})}};cmb.makeListSortable=function(){var $filelist=cmb.metabox().find(".cmb2-media-status.cmb-attach-list");if($filelist.length){$filelist.sortable({cursor:"move"}).disableSelection()}};cmb.maybeOembed=function(evt){var $self=$(this);var type=evt.type;var m={focusout:function(){setTimeout(function(){cmb.spinner(".postbox .cmb2-metabox",true)},2e3)},keyup:function(){var betw=function(min,max){return evt.which<=max&&evt.which>=min};if(betw(48,90)||betw(96,111)||betw(8,9)||evt.which===187||evt.which===190){cmb.doAjax($self,evt)}},paste:function(){setTimeout(function(){cmb.doAjax($self)},100)}};m[type]()};cmb.resizeoEmbeds=function(){cmb.metabox().each(function(){var $self=$(this);var $tableWrap=$self.parents(".inside");var isSide=$self.parents(".inner-sidebar").length||$self.parents("#side-sortables").length;var isSmall=isSide;var isSmallest=false;if(!$tableWrap.length){return true}var tableW=$tableWrap.width();if(cmb.styleBreakPoint>tableW){isSmall=true;isSmallest=cmb.styleBreakPoint-62>tableW}tableW=isSmall?tableW:Math.round($tableWrap.width()*.82*.97);var newWidth=tableW-30;if(isSmall&&!isSide&&!isSmallest){newWidth=newWidth-75}if(newWidth>639){return true}var $embeds=$self.find(".cmb-type-oembed .embed-status");var $children=$embeds.children().not(".cmb2-remove-wrapper");if(!$children.length){return true}$children.each(function(){var $self=$(this);var iwidth=$self.width();var iheight=$self.height();var _newWidth=newWidth;if($self.parents(".cmb-repeat-row").length&&!isSmall){_newWidth=newWidth-91;_newWidth=785>tableW?_newWidth-15:_newWidth}var newHeight=Math.round(_newWidth*iheight/iwidth);$self.width(_newWidth).height(newHeight)})})};cmb.log=function(){if(l10n.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments)}};cmb.spinner=function($context,hide){if(hide){$(".cmb-spinner",$context).hide()}else{$(".cmb-spinner",$context).show()}};cmb.doAjax=function($obj){var oembed_url=$obj.val();if(oembed_url.length<6){return}var field_id=$obj.attr("id");var $context=$obj.closest(".cmb-td");var $embed_container=$context.find(".embed-status");var $embed_wrap=$context.find(".embed_wrap");var $child_el=$embed_container.find(":first-child");var oembed_width=$embed_container.length&&$child_el.length?$child_el.width():$obj.width();cmb.log("oembed_url",oembed_url,field_id);cmb.spinner($context);$embed_wrap.html("");setTimeout(function(){if($(".cmb2-oembed:focus").val()!==oembed_url){return}$.ajax({type:"post",dataType:"json",url:l10n.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:oembed_url,oembed_width:oembed_width>300?oembed_width:300,field_id:field_id,object_id:$obj.data("objectid"),object_type:$obj.data("objecttype"),cmb2_ajax_nonce:l10n.ajax_nonce},success:function(response){cmb.log(response);cmb.spinner($context,true);$embed_wrap.html(response.data)}})},500)};$(document).ready(cmb.init);return cmb}(window,document,jQuery);