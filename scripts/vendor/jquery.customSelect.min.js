(function($){"use strict";$.fn.customSelectMenu=function(options){var settings=$.extend({menuClass:"custom-select-menu",openedClass:"opened",selectedClass:"selected",selectionMadeClass:"selection-made"},options);function updateMenu(selection){var customMenuName=selection.parent().attr("data-select-name"),customOptionValue=selection.attr("data-option-value"),customOptionText=selection.text(),hiddenInput=$('input[name="'+customMenuName+'"]');selection.parent().find("."+settings.selectedClass).removeClass(settings.selectedClass);selection.addClass(settings.selectedClass);hiddenInput.val(customOptionValue).attr("id",customMenuName+"_id").trigger("change");selection.parent().parent().find("label").text(customOptionText);if(hiddenInput.val()!==""){selection.parent().parent().find("label").addClass(settings.selectionMadeClass)}else{selection.parent().parent().find("label").removeClass(settings.selectionMadeClass)}selection.parent().hide();if(selection.parent().css("display")!=="none"){selection.parent().parent().find("label").toggleClass(settings.openedClass)}else{selection.parent().parent().find("label").removeClass(settings.openedClass)}}return this.each(function(){var $this=$(this),selectName=$this.attr("name"),selectId=$this.attr("id"),newHiddenInput,newContainer,newLabel,labelText,newList,newOption,selectedOption,selectedOptionValue;$this.hide();newContainer=$('<div class="'+settings.menuClass+'">').attr("tabindex",0);newList=$('<ul data-select-name="'+selectName+'">').hide();newHiddenInput=$('<input type="hidden" name="'+selectName+'" value="" />');if(selectId){newContainer.attr("id",selectId);$this.removeAttr("id")}if($this.find(":selected")){selectedOption=$this.find(":selected");selectedOptionValue=selectedOption.attr("value");labelText=selectedOption.text();if(!selectedOptionValue){newLabel=$("<label>"+labelText+"</label>")}else{newLabel=$('<label class="'+settings.selectionMadeClass+'">'+labelText+"</label>");newHiddenInput.val(selectedOptionValue).attr("id",selectName+"_id").trigger("change")}}else{labelText=$this.find(":first").text();newLabel=$("<label>"+labelText+"</label>")}$this.after(newContainer.append(newLabel,newList,newHiddenInput));$this.find("option").each(function(){var optionName=$(this).text(),optionValue=$(this).attr("value"),markSelected=optionName===labelText?' class="'+settings.selectedClass+'"':"";if(!optionValue){newOption=$("<li"+markSelected+">"+optionName+"</li>")}else{newOption=$('<li data-option-value="'+optionValue+'"'+markSelected+">"+optionName+"</li>")}newList.append(newOption)});newContainer.on("click",function(event){var target=$(event.target);if(target.is("label")){newLabel.toggleClass(settings.openedClass);newLabel.parent().find("ul").toggle()}if(target.is("li")){updateMenu(target)}});newContainer.on("keyup",function(e){if(e.keyCode===38||e.keyCode===40){$(this).find(newLabel).addClass(settings.openedClass);$(this).find(newList).show()}var li=$(this).find("li"),selectedLi=$(this).find("."+settings.selectedClass),nextLi="",prevLi="";if(e.keyCode===40){selectedLi.removeClass(settings.selectedClass);nextLi=selectedLi.next();if(nextLi.length>0){nextLi.addClass(settings.selectedClass)}else{li.first().addClass(settings.selectedClass)}}if(e.keyCode===38){selectedLi.removeClass(settings.selectedClass);prevLi=selectedLi.prev();if(prevLi.length>0){prevLi.addClass(settings.selectedClass)}else{li.last().addClass(settings.selectedClass)}}if(e.keyCode===13){updateMenu($(this).find("."+settings.selectedClass))}});newContainer.on("blur",function(){if($(this).find(newList).is(":visible")){$(this).find(newLabel).removeClass(settings.openedClass);$(this).find(newList).hide()}});$("html").on("keyup",function(e){if(e.keyCode===27){newLabel.removeClass(settings.openedClass);newList.hide()}});$("html").on("mousedown",function(event){var target=$(event.target);if(!target.parents().addBack().is("."+settings.menuClass+" ul, ."+settings.menuClass+" label")){$("."+settings.menuClass+" label").removeClass(settings.openedClass);$("."+settings.menuClass+" ul").hide()}});$this.remove()})}})(jQuery);